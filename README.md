# Трекер полезных привычек (Atomic Habits)

## Описание проекта
Трекер полезных привычек - это веб-приложение, вдохновленное книгой Джеймса Клира "Атомные привычки". 
Проект помогает пользователям формировать новые полезные привычки и избавляться от вредных, предоставляя
инструменты для отслеживания и напоминаний.

## Основные возможности
- Создание и управление привычками
- Настройка периодичности выполнения привычек
- Напоминания через Telegram
- Просмотр публичных привычек других пользователей
- Авторизация и управление профилем пользователя

## Установка:
1. Клонируйте репозиторий:
```https://github.com/Natalia-Epifanova/The_habits_project```
2. Установите зависимости:
```pip install -r requirements.txt```
3. Создайте и активируйте виртуальное окружение: 
- ```python -m venv venv```
- ```source venv/bin/activate```  # Linux/Mac
- ```venv\Scripts\activate```  # Windows
4. Выполнить миграции: ```python manage.py migrate```
5. Настройте переменные окружения: Создайте файл .env в корне проекта на основе .env.example
6. Создать суперпользователя: ```python manage.py csu```
7. . Запустить сервер: ```python manage.py runserver```
8. Для обработки периодических задач запустите Celery:
- ```celery -A config worker -l INFO```
- ```celery -A config beat -l INFO```

## API Endpoints
### Пользователи
- ```POST /users/register/``` - Регистрация нового пользователя
- ```POST /users/login/``` - Получение JWT токена
- ```POST /users/token/refresh/``` - Обновление JWT токена
- ```GET /users/profile/<pk>/``` - Просмотр профиля пользователя

### Привычки
- ```GET /habits/``` - Список привычек текущего пользователя
- ```GET /habits/public/``` - Список публичных привычек
- ```POST /habits/create/``` - Создание новой привычки
- ```GET /habits/<pk>/``` - Просмотр деталей привычки
- ```PUT /habits/<pk>/update/``` - Обновление привычки
- ```DELETE /habits/<pk>/delete/``` - Удаление привычки

### Периодичность
- ```GET /periodicity/``` - Список всех периодичностей
- ```POST /periodicity/``` - Создание новой периодичности
- ```GET /periodicity/<pk>/``` - Просмотр деталей периодичности
- ```PUT /periodicity/<pk>/``` - Полное обновление периодичности
- ```PATCH /periodicity/<pk>/``` - Частичное обновление периодичности
- ```DELETE /periodicity/<pk>/``` - Удаление периодичности

### Настройка Telegram бота
- Создайте бота через ```@BotFather``` и получите токен
- Укажите токен в переменной окружения ```BOT_TOKEN```
- Для получения chat_id пользователя:
1. Пользователь должен начать диалог с ботом
2. Отправить команду ```/start```
3. Chat_id будет сохранен в профиле пользователя

## Технологический стек
- Python 3.10+
- Django 4.2
- redis 6.2.0
- Django REST Framework
- Celery (для периодических задач)
- PostgreSQL (рекомендуемая СУБД)
- Telegram Bot API
- Nginx
- Docker
- GitHub Actions

## Локальный запуск с Docker

1. Убедитесь, что установлены Docker и Docker Compose
2. Создайте файл `.env` в корне проекта на основе `.env.example`
3. Запустите сервисы:
```bash docker-compose up -d --build ```
При первом запуске выполните миграции:
```bash docker-compose exec backend python manage.py migrate```

Приложение будет доступно на http://localhost:8000

## Настройка сервера для деплоя

### Установите на сервер:
- Docker
- Docker Compose
- Настройте SSH-доступ
- Добавьте секреты в GitHub Actions:
1. DOCKER_HUB_USERNAME - логин Docker Hub
2. DOCKER_HUB_ACCESS_TOKEN - токен Docker Hub
3. SERVER_SSH_KEY - приватный ключ для доступа к серверу
4. SSH_USER - пользователь сервера
5. SERVER_IP - IP сервера
6. SECRET_KEY - секретный ключ Django
7. BOT_TOKEN - токен для телеграм бота

### CI/CD Pipeline
Процесс автоматизирован:
- При push в репозиторий запускается workflow:
- Проверка кода flake8
- Запуск тестов
- Сборка и публикация Docker-образов
- Деплой на сервер (автоматический перезапуск контейнеров)

### Адрес сервера
http://89.169.190.54/habits/

## Тестирование
Проект покрыт тестами на 99%. Для запуска тестов:

```python manage.py test```

Разработано: Епифанова Наталия © 2025